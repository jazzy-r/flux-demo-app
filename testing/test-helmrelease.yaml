---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: dagster
  namespace: flux-system
spec:
  chart:
    spec:
      chart: dagster
      sourceRef:
        kind: HelmRepository
        name: dagster
      version: 0.13.13
  install:
    createNamespace: true
  interval: 1m0s
  targetNamespace: dagster
  values:
    dagster-user-deployments:
      deployments:
        - name: "k8s-example-user-code-1"
          image:
            repository: "docker.io/dagster/user-code-example"
            tag: 0.13.13
            pullPolicy: Always
          dagsterApiGrpcArgs:
            - "--python-file"
            - "/example_project/example_repo/repo.py"
          port: 3030
  valuesFrom:
    - kind: ConfigMap
      name: podinfo-values